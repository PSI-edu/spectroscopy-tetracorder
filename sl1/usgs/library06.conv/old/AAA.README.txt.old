This file describes how to create the splib06* convolved spectral libraries.

Convolved spectral library names can be at most 8-characters long,
because of a name size limit in specpr, which manages libraries,
so the following abbreviations are used.

You will need to create two files:

     a specpr restart file pointing to the relevant specpr files.

     A specpr file containing the wavelengths and resolution of the
     target data set to convolve the spectral library to.
     The wavelengths and resoltuion entries MUST be at specific locations.

===============================================================================
Note: on speclab1, speclab3, cassini, etc, make a link:

     ln -s /s0/d1/speclib/ /speclib

===============================================================================

annccyyd
            a = s for spectral library
            nn= library version number
            cc= output convolved spectrometer model/type
            yy= year or other code
            d = output spectrometer version within year yy


         as = aster,
         av = aviris,  e.g. aviris 1995: av95a
         cr = crism
         hd = Hydice,
         hy = HyMap
         mi = MIVIS
         mm = Moon Mineralogy Mapper (2008)
         nm = nims,
         pb = probe
         pf = Mars pathfinder
         tm = LandsatTM (followed by 04, 05, 07 for with TM)
         vm = vims

         ng = na test


         nc = nicolet, followed by wavenumber resolution, e.g 4 cm^-1
              would be nc04, 0.5 cm^1 would be nc.5

         fs00 = ASD field spectrometer 2151
         fs71 = ASD field spectrometer 717ch
         fs35 = field spectrometer 358ch
         bk1x = usgs beckman, 1x = standard resolution
         gr = gregg's resolution study,

===============================================================================
Specpr record numbering:
Padding is added to records so that spectra with 1022 channels or
less all have the same record number in the convolved libraries.
===============================================================================
Cross reference to older splib04* libraries:

New      original
       splib04 name

s06av90a splib04c  AVIRIS 1990 convolution 224 channels. (e.g. Cuprite) 
s06av90b splib04d  AVIRIS 1990 convolution 208 channels

s06av91a splib04e  AVIRIS 1991 convolution 224 channels.
s06av91b splib04f  AVIRIS 1991 convolution 208 channels. 

NOTE: 1992 AVIRIS had wavelength shifts that are flight spoecific.
         Some data sets may have shifts requiring non-standard wavelengths.

s06av92a splib04g  AVIRIS 1992 convolution 224 channels standard JPL waves.
s06av92b splib04h  AVIRIS 1992 convolution 197 channels standard JPL waves.
s06av92c splib4g1  AVIRIS 1992 convolution 224 channels Bodie 8/20/92 waves.

s06av93a splib04i  AVIRIS 1993 convolution 224 channels. Cuprite 5/1993
s06av93b splib04j  AVIRIS 1993 convolution 198 channels. Cuprite 5/1993

s06av93c splib04k  AVIRIS 1993 convolution 224 channels. summitville 9/3/1993

s06av94a splib04m  AVIRIS 1994 convolution 224 channels. 5/1994

s06av95a splib04n  AVIRIS 1995 convolution 224 channels Alpha & Beta ver. 6/1995

s06nm95a splib04o  Galileo NIMS 1

         splib04p  Cassini VIMS94 proposed   (in sprlib/lib02/vims)
         splib4p1  Cassini VIMSIR preliminary 1 3/95
s06vm00a           Cassini VIMS thermal vac wavelengths
s06vm04a           Cassini VIMS Criuse wavelengths 2004 (thermal vac + 0.3 ch in IR)

s06as96a splib04q  ASTER96

s06av96a splib04r  AVIRIS 1996 convolution 224 channels

s06mi94a splib04s  MIVIS94 (in sprlib/lib02/mivis)

s06fs35a splib04t  field spectrometer 358ch

s06hy94a splib04u  HYDICE94 (in sprlib/lib02/hydice)

	 splib04v  1901ch resampled Beckman Resolution

s06tm05a splib04w  TM

s06pf00a splib04x  Pathfinder IMP imager  Mars

s06av97a splib04y  AVIRIS 1997 convolution 224 channels.

s06av98a splib04z  AVIRIS 1998 convolution 224 channels.

s06av99a s04av99a  AVIRIS 1999 convolution 224 channels.

s06av00a s04av00a  AVIRIS 2000 convolution 224 channels.

s06av01a s04av01a  AVIRIS 2001 convolution 224 channels.
	 
s06as04a s05as04a  ASTER 2004 convolution of splib05a.

s06av05a s04av05a  AVIRIS 2005 convolution 224 channels.

s06av10a s04av10a  AVIRIS 2010 convolution 224 channels.

s06fs00a           ASD field spectrometer standard waves, 2151 channels, std resol


note: the letter l was skipped in the designation splib04_ to avoid confusion
      with the number 1.
===============================================================================
splib06b

Making data product files Convolutions.

First you must make a higher channel interpolated library.  This
increases the trapezoidal integration in the convolution routines by
giving more bins per input spectrometer channel.
Nicolet and ASD Fieldspectrometer data are not interpolated.

           mak.splib06b.splin.cmds

(This takes a couple of seconds on modern computers.)

Next:

           cp startfiles/splib06b.start splib06b
           cp restartfiles/r1.splib06b  r1.splib06b

Next start specpr (or dspecpr) with the r1.splib06b restart file and execute the
specpr command file (optional: use -gxterm2 instead of -gxterm to get a larger
window):

           dspecpr r1.splib06b -gxterm -
           <splib06b.splin.cmds

This takes 92.6u 5.0s 1:49 89% on speclab (and fast linux x-terminal) 02/06/2008

##############################################################################
convolution of instrument libraries:

First, for each instrument make:

            *  the specpr restart file and the 

            *  the specpr start file with the wavelength and resolution of the
               convolved instrument.

A specpr start file has the entries like this example for ABVIRIS 1995,
which you must create by hand:

spprint startfiles/s06av95a.start
     1  USGS Digital Spectral Library: s06av95a    410 Characters of TEXT
     2  Convolved AVIRIS 1995.1 224 ch library     147 Characters of TEXT
     3  ****************************************    41 Characters of TEXT
     4  ****************************************    41 Characters of TEXT
     5  ..                                          41 Characters of TEXT
     6  Wavelengths in microns 224ch AVIRIS95.1    224  00:00:00.00  06/23/1995
     7  ..                                          41 Characters of TEXT
     8  ..                                          41 Characters of TEXT
     9  ..                                          41 Characters of TEXT
    10  ..                                          41 Characters of TEXT
    11  ..                                          41 Characters of TEXT
    12  Resolution  in microns 224ch AVIRIS95.1    224  00:00:00.00  06/23/1995
    13  ..                                          41 Characters of TEXT
    14  ..                                          41 Characters of TEXT
    15  ..                                          41 Characters of TEXT
    16  ..                                          41 Characters of TEXT
    17  ..                                          41 Characters of TEXT
    18  Data value = channel number (224 ch)       208  00:00:00.00  06/03/1992
    19  ..                                          41 Characters of TEXT
    20  ..                                          41 Characters of TEXT
    21  ..                                          41 Characters of TEXT
    22  ..                                          41 Characters of TEXT
    23  ..                                          41 Characters of TEXT
    24  ..                                          41 Characters of TEXT
    25  ..                                          41 Characters of TEXT
    26  ..                                          41 Characters of TEXT
    27  ..                                          41 Characters of TEXT
    28  ..                                          41 Characters of TEXT
    29  ..                                          41 Characters of TEXT


The file startfiles/s06av95a.start gets copied to this directory with the name s06av95a

It is very important that the:

           ".." file is in record 5,
            wavelengths in record 6,
            resolution  in record 12,

and the file be padded to record 29 so that the first convolved spectrum goes into
record 30.  This strategy ensures that spectra with channels 1 to 2171 will
have the same record numbers.  Spectra greater than 2171 channels is not yet
supported.

The spepcr restart file:

     v = the convolved instrument library (this is the output of the convolutions.
     y = splib06b


##############################################################################


To convolve a library after the specpr restart and startup files are created,
run the command:


     mak.convol.library  library version channels name     resol_number


example:

     mak.convol.library  s06av95  a        224   AVIRIS95 12

creates spectral library s06av95a
Each convolution takes about 6.2 minutes on speclab1 Feb 2008 for 352 vims channels
                       about 4.5 minutes for aviris
     on fast x-terminals.

     ASD 2151 channels on cassini: 5.5 minutes xterm2 4/2012

***************************************************************
Specpr restarts:

dspecpr restartfiles/r.s06cr08b -gxterm2 -   # CRISM 72 channel

***************************************************************
***************************************************************
***********                           *************************
***********    convolution commands   *************************
***********                           *************************
***************************************************************
***************************************************************

Commands:

#                prog              lib     n  chan  title    fwhm
#                                                   keyword  rec number

AVIRIS:
            ./mak.convol.library  s06av95  a  224   AVIRIS95 12  # aviris 1995
            ./mak.convol.library  s06av05  a  224   AVIRIS05 12  # aviris 2005
            ./mak.convol.library  s06av06  a  224   AVIRIS06 12  # aviris 2006
            ./mak.convol.library  s06av10  a  224   AVIRIS10 12  # aviris 2010

VIMS:
            ./mak.convol.library  s06vm07  a  352   VIMS07   12

CRISM:
            ./mak.convol.library  s06cr08  a  438   CRISM08a 12   # 2008 IR only
            ./mak.convol.library  s06cr08  b   72   CRISM08b 12   # 2008 waves global tile mode
            ./mak.convol.library  s06cr11  v  107   CRISM11v 12   # 2011 VIS only
            ./mak.convol.library  s06crj3  a  489   CRISMj3a 12   # 2012 J_MTR3 merged V+IR version a
                                                                  # note: this took 9 minutes running
                                                                  # remote X over DSL (on cassini)

Moon Mineralogy Mapper:

            ./mak.convol.library  s06mm07  a  260   MMM      12  # 2007 targeted waves
            ./mak.convol.library  s06mm07  c   86   MMM      12  # 2007 global waves
            ./mak.convol.library  s06mm07  s  260   MMM      12  # 2007 synthetic test 1 waves

            ./mak.convol.library  s06mm09  a  260   MMM      12  # 2009 targeted waves
            ./mak.convol.library  s06mm09  c   85   MMM      12  # 2009 global waves


ASD Field spectrometer, standard waves and resolution, 2151 channels:

           ./mak.convol.library  s06fs00   a 2151  ASDfs00a  12  




